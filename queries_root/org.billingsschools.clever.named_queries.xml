<?xml version="1.0"?>
<queries>
  <query name="org.billingsschools.clever.admins" coreTable="USERS" flattened="true" tags="">
    <summary>Clever Admins</summary>
    <description>Clever Admins data</description>
    <columns>
      <column column="SCHOOLSTAFF.SCHOOLID">SCHOOL_ID</column>
      <column column="USERS.DCID">STAFF_ID</column>
      <column column="USERS.EMAIL_ADDR">ADMIN_EMAIL</column>
      <column column="USERS.FIRST_NAME">FIRST_NAME</column>
      <column column="USERS.LAST_NAME">LAST_NAME</column>
      <column column="USERS.FIRST_NAME">ADMIN_TITLE</column>
      <column column="USERS.EMAIL_ADDR">USERNAME</column>
      <column column="USERS.EMAIL_ADDR">PASSWORD</column>
    </columns>
    <sql><![CDATA[
      select distinct
        ss.schoolid school_id,
        u.dcid staff_id,
        u.email_addr admin_email,
        u.first_name first_name,
        u.last_name last_name,
        '' admin_title,
        substr(u.email_addr, 0, instr(u.email_addr, '@')-1) username,
        '' password
      from
        users u
        left join schoolstaff ss
          on ss.users_dcid = u.dcid
        left join s_mt_usr_x mt
          on mt.usersdcid = u.dcid
      where
        ss.schoolid not in (0, 999999, 6200, 1267, 1258, 1834)
        and u.psaccess = 1
        and ss.status = 1
        and u.groupvalue in (2,3,4,10,11)
        and u.last_name not in ('ETS', 'Health/Pe', 'Music', 'Team', 'Staff', 'Staff 1', 'Staff 2', 'Staff 3', 'Staff 4', 'Staff 5', 'Staff 6')
        and u.first_name not in ('1', '2', '3', '4', '5', '6', 'staff')
      order by
        u.last_name,
        u.first_name
      ]]></sql>
  </query>
  <query name="org.billingsschools.clever.enrollments" coreTable="CC" flattened="true" tags="">
    <summary>Clever Enrollments</summary>
    <description>Clever Enrollments data</description>
    <columns>
      <column column="CC.SCHOOLID">SCHOOL_ID</column>
      <column column="CC.SECTIONID">SECTION_ID</column>
      <column column="CC.STUDENTID">STUDENT_ID</column>
    </columns>
    <sql><![CDATA[
      with first_day_or_today as (
        select
          case
            when t.firstday > sysdate then t.firstday
            else sysdate
          end effdate
        from
          terms t
        where
          t.id = (extract(year from sysdate) + case when extract(month from sysdate) >= 7 then 1 else 0 end - 1991) * 100
          and t.schoolid = 0
          and t.isyearrec = 1
      )

      select
        cc.schoolid school_id,
        cc.sectionid section_id,
        cc.studentid student_id
      from
        cc
      where
        cc.schoolid not in (0, 999999, 6200, 1267, 1258, 1834)
        and cc.dateenrolled <= (select effdate from first_day_or_today)
        and cc.dateleft > (select effdate from first_day_or_today)
        and cc.sectionid > 0
      ]]></sql>
  </query>
  <query name="org.billingsschools.clever.schools" coreTable="SCHOOLS" flattened="true" tags="">
    <summary>Clever Schools</summary>
    <description>Clever Schools data</description>
    <columns>
      <column column="SCHOOLS.SCHOOL_NUMBER">SCHOOL_ID</column>
      <column column="SCHOOLS.NAME">SCHOOL_NAME</column>
      <column column="SCHOOLS.SCHOOL_NUMBER">SCHOOL_NUMBER</column>
      <column column="SCHOOLS.SCHOOL_NUMBER">STATE_ID</column>
      <column column="SCHOOLS.LOW_GRADE">LOW_GRADE</column>
      <column column="SCHOOLS.HIGH_GRADE">HIGH_GRADE</column>
      <column column="SCHOOLS.PRINCIPAL">PRINCIPAL</column>
      <column column="SCHOOLS.PRINCIPALEMAIL">PRINCIPAL_EMAIL</column>
      <column column="SCHOOLS.SCHOOLADDRESS">SCHOOL_ADDRESS</column>
      <column column="SCHOOLS.SCHOOLCITY">SCHOOL_CITY</column>
      <column column="SCHOOLS.SCHOOLSTATE">SCHOOL_STATE</column>
      <column column="SCHOOLS.SCHOOLZIP">SCHOOL_ZIP</column>
      <column column="SCHOOLS.SCHOOLPHONE">SCHOOL_PHONE</column>
    </columns>
    <sql><![CDATA[
      select
        sch.school_number School_id,
        sch.name School_name,
        sch.school_number,
        sch.school_number state_id,
        sch.low_grade,
        sch.high_grade,
        sch.principal Principal,
        sch.principalemail Principal_email,
        sch.schooladdress School_address,
        sch.schoolcity School_city,
        sch.schoolstate school_state,
        sch.schoolzip School_zip,
        sch.schoolphone School_phone
      from
        schools sch
      where
        sch.school_number not in (0, 999999, 6200, 1267, 1258, 1834)
      ]]></sql>
  </query>
</queries>
